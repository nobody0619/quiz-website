
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; text-align: center; }
    #score { font-size: 1.2em; margin: 20px 0; }
    .question { text-align: left; margin: 20px 0; }
    .options { margin: 10px 0; text-align: left; }
    .option-label { display: block; margin: 5px 0; }
    .feedback { margin: 10px 0; font-weight: bold; }
    button { margin: 5px; padding: 10px 20px; }
    img { max-width: 100%; height: auto; margin: 10px 0; }
    input[type="radio"] { accent-color: blue; }
    input[type="checkbox"] { accent-color: green; }
    input[type="text"] { width: 100%; padding: 5px; }
  </style>
</head>
<body>
  <div id="score">Score: 0.0</div>
  <div id="quiz"></div>
  <script>
    // Load questions
    fetch('questions.csv')
      .then(res => res.text())
      .then(csv => {
        const lines = csv.trim().split('\n');
        const headers = lines[0].split(',');
        const data = lines.slice(1).map(line => {
          const cols = line.split(',');
          let obj = {};
          headers.forEach((h,i) => obj[h.trim()] = cols[i]?.trim());
          return obj;
        }).filter(q => q.type && q.question).map(q => ({...q, attempt:0}));
        startQuiz(data);
      });

    function startQuiz(questions) {
      let score = 0;
      let queue = shuffle(questions.slice());
      let quizDiv = document.getElementById('quiz');
      let scoreDiv = document.getElementById('score');

      function updateScore() {
        scoreDiv.textContent = 'Score: ' + score.toFixed(1);
      }

      function next() {
        if (queue.length === 0) {
          quizDiv.innerHTML = '<h3>Quiz Complete</h3><p>Final Score: ' + score.toFixed(1) + '</p>';
          return;
        }
        let q = queue.shift();
        quizDiv.innerHTML = '';
        let div = document.createElement('div'); div.className='question';
        div.innerHTML = '<p><strong>' + q.question + '</strong></p>';
        if (q.image) {
          let img = document.createElement('img'); img.src = q.image; div.appendChild(img);
        }
        let optsDiv = document.createElement('div'); optsDiv.className='options';
        if (q.type === 'text') {
          optsDiv.innerHTML = '<input type="text" id="ans" placeholder="Answer">';
        } else {
          ['A','B','C','D','E','F','G','H'].forEach(letter => {
            if (q[letter]) {
              let input = document.createElement('input');
              input.type = q.type === 'checkbox' ? 'checkbox' : 'radio';
              input.name = 'opt';
              input.value = letter;
              let label = document.createElement('label');
              label.className='option-label';
              label.appendChild(input);
              label.append(' ' + letter + '. ' + q[letter]);
              optsDiv.appendChild(label);
            }
          });
        }
        div.appendChild(optsDiv);
        let fb = document.createElement('div'); fb.className='feedback'; div.appendChild(fb);

        let submit = document.createElement('button'); submit.textContent='Submit';
        submit.onclick = () => {
          let ua;
          if (q.type==='text') ua = document.getElementById('ans').value.trim();
          else {
            let sels = Array.from(div.querySelectorAll('input[name="opt"]:checked')).map(i=>i.value).sort();
            ua = sels.join(',');
          }
          let correct = q.answer.split(',').map(s=>s.trim()).sort().join(',');
          if (ua.toLowerCase() === correct.toLowerCase()) {
            score += q.attempt > 0 ? 0.5 : 1;
            fb.textContent = 'Correct!';
          } else {
            score -= 0.5;
            fb.textContent = 'Wrong! Correct: ' + q.answer;
            q.attempt++;
            if (q.attempt <= 2) queue.splice(Math.floor(Math.random()*queue.length),0,q);
          }
          updateScore();
          submit.disabled = true;
          nextBtn.style.display = 'inline-block';
        };
        div.appendChild(submit);

        let nextBtn = document.createElement('button'); nextBtn.textContent='Next'; nextBtn.style.display='none';
        nextBtn.onclick = next;
        div.appendChild(nextBtn);
        quizDiv.appendChild(div);
      }

      updateScore();
      next();
    }

    function shuffle(a) {
      for (let i=a.length-1;i>0;i--) {
        let j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
  </script>
</body>
</html>
